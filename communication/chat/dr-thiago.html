<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instituto Dutra - Chat Dr. Thiago</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.4.47/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../../styles/global.css">
    <script src="../../styles/theme.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* Header */
        .chatHeader {
            background: var(--primary);
            color: var(--neutral-white);
            padding: 60px 20px 24px;
            position: relative;
            overflow: hidden;
            flex-shrink: 0;
        }

        .chatHeader::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            opacity: 0.7;
        }

        .headerContent {
            position: relative;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .backButton {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-white);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .backButton:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .contactInfo {
            flex: 1;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .contactAvatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
            min-width: 48px;
        }

        .contactDetails h1 {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
        }

        .contactStatus {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            opacity: 0.8;
        }

        .statusDot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .menuButton {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-white);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .menuButton:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Messages Area */
        .messagesContainer {
            flex: 1;
            overflow-y: auto;
            padding: 16px 20px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .messageGroup {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .messageGroup.sent {
            align-items: flex-end;
        }

        .messageGroup.received {
            align-items: flex-start;
        }

        .message {
            max-width: 75%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
            position: relative;
        }

        .message.sent {
            background: var(--primary);
            color: var(--neutral-white);
            border-bottom-right-radius: 6px;
        }

        .message.received {
            background: var(--message-received-bg);
            color: var(--text-primary);
            border-bottom-left-radius: 6px;
            box-shadow: 0 1px 4px var(--shadow-soft);
        }

        .messageTime {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
            text-align: right;
        }

        .message.sent .messageTime {
            color: rgba(255, 255, 255, 0.7);
        }

        .messageInfo {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .senderAvatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(58, 74, 58, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 16px;
        }

        .senderName {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .messageDate {
            text-align: center;
            color: var(--text-muted);
            font-size: 12px;
            font-weight: 500;
            margin: 16px 0;
            position: relative;
        }

        .messageDate::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            width: 100%;
            height: 1px;
            background: var(--border-light);
            z-index: 0;
        }

        .messageDate span {
            background: var(--background-lighter);
            padding: 0 16px;
            position: relative;
            z-index: 1;
        }

        /* Input Area */
        .inputArea {
            background: var(--neutral-white);
            padding: 16px 20px;
            border-top: 1px solid var(--border-light);
            flex-shrink: 0;
            box-shadow: 0 -2px 12px var(--shadow-soft);
        }

        .inputContainer {
            display: flex;
            align-items: flex-end;
            gap: 12px;
        }

        .attachButton {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(58, 74, 58, 0.1);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .attachButton:hover {
            background: rgba(58, 74, 58, 0.2);
        }

        .messageInputWrapper {
            flex: 1;
            background: var(--background-lighter);
            border-radius: 20px;
            border: 2px solid var(--border-light);
            display: flex;
            align-items: flex-end;
            min-height: 40px;
            max-height: 100px;
            transition: all 0.3s ease;
        }

        .messageInputWrapper:focus-within {
            border-color: var(--primary);
        }

        .messageInput {
            flex: 1;
            border: none;
            background: transparent;
            padding: 10px 16px;
            font-size: 14px;
            outline: none;
            resize: none;
            min-height: 20px;
            max-height: 80px;
            overflow-y: auto;
        }

        .messageInput::placeholder {
            color: var(--text-placeholder);
        }

        .sendButton {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--neutral-white);
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .sendButton:hover {
            background: var(--primary-light);
            transform: scale(1.05);
        }

        .sendButton:disabled {
            background: var(--border-light);
            cursor: not-allowed;
            transform: none;
        }

        /* Responsivo */
        @media (max-width: 480px) {
            .chatHeader {
                padding: 50px 16px 20px;
            }

            .messagesContainer {
                padding: 12px 16px;
            }

            .inputArea {
                padding: 12px 16px;
            }

            .message {
                max-width: 85%;
                padding: 10px 14px;
            }
        }

        /* Scroll personalizado */
        .messagesContainer::-webkit-scrollbar {
            width: 4px;
        }

        .messagesContainer::-webkit-scrollbar-track {
            background: transparent;
        }

        .messagesContainer::-webkit-scrollbar-thumb {
            background: var(--border-light);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="chatHeader">
        <div class="headerContent">
            <button class="backButton" onclick="goBack()">
                <i class="mdi mdi-arrow-left"></i>
            </button>
            <div class="contactInfo">
                <div class="contactAvatar">
                    <i class="mdi mdi-stethoscope"></i>
                </div>
                <div class="contactDetails">
                    <h1>Dr. Thiago Dutra</h1>
                    <div class="contactStatus">
                        <div class="statusDot"></div>
                        <span>Online</span>
                    </div>
                </div>
            </div>
            <button class="menuButton" onclick="showChatMenu()">
                <i class="mdi mdi-dots-vertical"></i>
            </button>
        </div>
    </div>

    <!-- Messages -->
    <div class="messagesContainer" id="messagesContainer">
        <div class="messageDate">
            <span>Ontem, 2 de agosto</span>
        </div>

        <div class="messageGroup sent">
            <div class="message sent">
                Doutor, boa tarde! Meus exames chegaram hoje. Posso enviar?
                <div class="messageTime">16:30</div>
            </div>
        </div>

        <div class="messageGroup received">
            <div class="messageInfo">
                <div class="senderAvatar">
                    <i class="mdi mdi-account-tie"></i>
                </div>
                <span class="senderName">Dr. Thiago Dutra</span>
            </div>
            <div class="message received">
                Claro, Maria! Pode enviar sim. Estou aguardando principalmente os de tireoide e glicemia.
                <div class="messageTime">16:45</div>
            </div>
        </div>

        <div class="messageGroup sent">
            <div class="message sent">
                Perfeito! Acabei de enviar por email também. Como estão os resultados?
                <div class="messageTime">16:47</div>
            </div>
        </div>

        <div class="messageGroup received">
            <div class="message received">
                Acabei de analisar! Excelentes resultados, Maria! 🎉
                <div class="messageTime">17:15</div>
            </div>
        </div>

        <div class="messageGroup received">
            <div class="message received">
                Sua glicemia está perfeita (92 mg/dL) e o TSH também normalizou completamente. O Mounjaro está funcionando muito bem!
                <div class="messageTime">17:16</div>
            </div>
        </div>

        <div class="messageGroup sent">
            <div class="message sent">
                Que alegria, doutor! 😍 Posso continuar com a mesma dosagem?
                <div class="messageTime">17:20</div>
            </div>
        </div>

        <div class="messageGroup received">
            <div class="message received">
                Sim! Mantenha a dosagem atual por mais 4 semanas. Continue seguindo o protocolo nutricional à risca.
                <div class="messageTime">17:22</div>
            </div>
        </div>

        <div class="messageGroup received">
            <div class="message received">
                Nossa próxima consulta é na quarta às 14h30. Vamos revisar toda sua evolução e planejar os próximos passos. Parabéns pelo comprometimento! 👏
                <div class="messageTime">17:23</div>
            </div>
        </div>

        <div class="messageDate">
            <span>Hoje, 3 de agosto</span>
        </div>

        <div class="messageGroup sent">
            <div class="message sent">
                Bom dia, doutor! Obrigada pelo retorno ontem. Estou muito motivada! 💪
                <div class="messageTime">08:15</div>
            </div>
        </div>
    </div>

    <!-- Input Area -->
    <div class="inputArea">
        <div class="inputContainer">
            <button class="attachButton" onclick="showAttachMenu()">
                <i class="mdi mdi-plus"></i>
            </button>
            <div class="messageInputWrapper">
                <textarea 
                    class="messageInput" 
                    id="messageInput" 
                    placeholder="Digite sua mensagem para Dr. Thiago..."
                    rows="1"
                    onkeydown="handleKeyPress(event)"
                    oninput="adjustTextareaHeight(this)"
                ></textarea>
            </div>
            <button class="sendButton" id="sendButton" onclick="sendMessage()" disabled>
                <i class="mdi mdi-send"></i>
            </button>
        </div>
    </div>

    <script>
        let messageContainer = document.getElementById('messagesContainer');
        let messageInput = document.getElementById('messageInput');
        let sendButton = document.getElementById('sendButton');

        function goBack() {
            window.location.href = '../index.html';
        }

        function showChatMenu() {
            alert('Menu do chat:\n• Ver perfil médico\n• Histórico consultas\n• Agenda próxima consulta\n• Configurações');
        }

        function showAttachMenu() {
            alert('Anexar:\n📄 Exames\n📊 Relatórios\n📷 Foto\n📝 Anotações\n(Demo)');
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 80) + 'px';
            
            sendButton.disabled = textarea.value.trim() === '';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            const messageGroup = document.createElement('div');
            messageGroup.className = 'messageGroup sent';
            
            const messageElement = document.createElement('div');
            messageElement.className = 'message sent';
            
            const now = new Date();
            const time = now.getHours().toString().padStart(2, '0') + ':' + 
                        now.getMinutes().toString().padStart(2, '0');
            
            messageElement.innerHTML = `
                ${message}
                <div class="messageTime">${time}</div>
            `;
            
            messageGroup.appendChild(messageElement);
            messageContainer.appendChild(messageGroup);
            
            messageInput.value = '';
            adjustTextareaHeight(messageInput);
            messageContainer.scrollTop = messageContainer.scrollHeight;
            
            // Simula resposta do médico (demo)
            setTimeout(() => {
                addDoctorResponse();
            }, 3000);
        }

        function addDoctorResponse() {
            const responses = [
                'Obrigado pela mensagem! Vou analisar e te respondo em breve.',
                'Perfeito! Continue assim que você está no caminho certo.',
                'Ótima pergunta! Vou incluir isso na nossa próxima consulta.',
                'Entendi! Qualquer urgência me chame no WhatsApp da clínica.',
                'Excelente! Seus resultados mostram que o tratamento está perfeito.'
            ];
            
            const randomResponse = responses[Math.floor(Math.random() * responses.length)];
            
            const messageGroup = document.createElement('div');
            messageGroup.className = 'messageGroup received';
            
            const messageInfo = document.createElement('div');
            messageInfo.className = 'messageInfo';
            messageInfo.innerHTML = `
                <div class="senderAvatar">
                    <i class="mdi mdi-account-tie"></i>
                </div>
                <span class="senderName">Dr. Thiago Dutra</span>
            `;
            
            const messageElement = document.createElement('div');
            messageElement.className = 'message received';
            
            const now = new Date();
            const time = now.getHours().toString().padStart(2, '0') + ':' + 
                        now.getMinutes().toString().padStart(2, '0');
            
            messageElement.innerHTML = `
                ${randomResponse}
                <div class="messageTime">${time}</div>
            `;
            
            messageGroup.appendChild(messageInfo);
            messageGroup.appendChild(messageElement);
            messageContainer.appendChild(messageGroup);
            
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }

        // Auto-scroll inicial
        messageContainer.scrollTop = messageContainer.scrollHeight;
        messageInput.focus();
    </script>
</body>
</html>